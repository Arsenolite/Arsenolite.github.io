---
title: 2020-04-13-高阶面试题知识集合笔记
date: 2020-04-13 15:53:16
tags: ["Java","面经读后感"]
categories: ["2020-04"]
---

### 前言

嗯……写了快三年代码了，回望一下自己的博客，从当年命名规范都不清楚的小白，到现在。。熟悉了命名规范的小白（笑）

对自我的定义应该是：比较擅长在需求较明确的前提下，使用常用工具构建无需特别优化的Java Web后端程序的Java程序员，也对爬虫和Web后端性能优化比较感兴趣。

曾经对微服务、消息队列、缓存等知识是兴致缺缺，一方面没有好的资料，一方面两三年前不需要这些知识的岗位机会也有不少。

然而两年九个月过去了，对一些单机Web后端用到的技术，不敢说熟悉，日常理解是没多大问题了；恰好经树总推荐，拜读了DDIA，以及一些讲述大型网站的书籍，觉得是时候总结一些这方面的知识了。

虽然总觉得这些是90%的企业用不到的东西，但毕竟竞争日益激烈，再加上像是**`@Transaction` `@Cacheable`注解是基于AOP，AOP又是基于动态代理**，或者是**JVM采用分代垃圾收集，年轻代标记复制到老年代，老年代用CMS标记并发清除，或者用G1分区域标记整理**这些几年前学过的知识点，反复啃起来也没什么意思。。

### 消息队列

#### 优缺点、如何选型

##### 优点：

- 降低订阅消息与否的开发成本

- 异步化逻辑，提高性能

##### 缺点：

- 降低可用性，一致性，提高复杂度

##### 选型：

http://www.ijiandao.com/2b/baijia/97775.html



###### 延迟：

RabbitMQ微秒级延迟，RocketMQ、Kafka使用长轮询，毫秒级

###### 吞吐：

RabbitMQ万级，RocketMQ、Kafka十万级

Kafka的TPS在64个Topic时可以保持13万，到了128个Topic就跌至0.85万，原因是每个Topic、每个分区都会对应一个物理文件

###### 可用性

RabbitMQ主从架构，RocketMQ、Kafka分布式架构

###### 功能

RocketMQ支持定时消息、事务消息，消息查询，按时间回溯，乱序消费，消费轨迹，消息过滤

#### 幂等性

#### 可靠性

http://jm.taobao.org/2016/04/28/kafka-vs-rocktemq-4/

#### 可用性

#### 延迟和积压问题

#### 自己设计

http://jm.taobao.org/2017/03/23/20170323/

### 搜索引擎

### 共识算法理论



### 分布式事务实践

借鉴蚂蚁金服分布式事务中间件 https://github.com/seata/seata

XA采用2PC模式，实际微服务实践中不用，因为不允许跨服务访问数据库

#### SAGA模式

基于状态机引擎，一致性弱，适用于事务参与者无法接入TCC改造的过程

可能会出现脏写，但是会尽可能保证最终一致性

https://www.sofastack.tech/blog/sofa-channel-10-retrospect/

#### RocketMQ事务消息：

1. 发送者发半事务消息给消息队列

2. 发送者执行事务

3. 发送者提交二次确认消息/消息队列回查发送者，确认提交/回滚

4. 消息队列负责不断重试投递给订阅者
5. 订阅者失败，则报警人工处理

#### AT模式：

无侵入，二阶段回滚出现脏写需要人工介入

步骤：

- 框架拦截SQL，找到要更新的数据，在执行前后保存快照，再获取行锁

- 提交：删除快照和行锁
- 回滚：对比**当前数据**和**执行后快照**，一致则还原，不一致则转人工

#### TCC模式：

个人理解和2PC实际上是一回事，只不过2PC直接操作数据库事务，而TCC把这一概念放到了业务层，并且不需要持久层实际支持XA。

相比AT侵入性高，但是没有全局行锁，性能高

需要改造业务，业务分为try confirm和cancel步骤，try预留资源，confirm实际执行，cancel释放资源。

- 幂等性：需要保证三个步骤**幂等**。

- 并发控制：try预留的资源必须与事务ID关联，不同事务不能预留同一资源。

- 支持空回滚：需要在try业务未达时，就能处理cancel业务。

- 防悬挂：需要在cancel业务处理完后，能拒绝try业务。

整个事务所有方法每一步执行落地数据库，这样每个事务可查。

优化：confirm/cancel操作可以异步执行，事务记录可以记录在发起者业务数据库。

### 分布式事务理论
#### 2PC优化

http://oceanbase.org.cn/?p=195

### 缓存
https://doocs.github.io/advanced-java/#/./docs/high-concurrency/why-cache
#### Redis线程模型

#### Redis数据类型

#### Redis性能，生产部署

#### Redis哨兵高可用

#### Redis穿透、雪崩、击穿

#### 数据库一致性

#### Redis锁和事务

### 微服务实践

#### 服务治理实践

#### 微服务框架使用

#### 微服务拆分实践

### 领域驱动设计

https://tech.meituan.com/2017/12/22/ddd-in-practice.html
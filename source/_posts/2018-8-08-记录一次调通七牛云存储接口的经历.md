---
title: 记录一次调通七牛云存储接口的经历
tags: ["Java","七牛云"]
categories: ["2018-08"]
date: 2018-08-08 16:17:54
---
换了新东家，单位配了Mac，由于hexo只会推送生成好的HTML，没有存Markdown源文件，没法写博客（强行给偷懒找借口）。

最近需要同时开多个项目，低压U承受不住，平时操作卡顿，因此换回台式。

新项目中有用到七牛云存储，需求是给存储的图片、视频加上水印，视频需要有缩略图。

于是开始研究七牛云的文档，历时两天终于调通接口，特此记一笔。

调图像水印的接口时遇到的问题是我的低级失误，某个Config类输出七牛云格式的参数时 忘记输出StringBuilder.toString()了，而是用了默认的null。

调视频水印的时候，七牛云有一个坑，调用`预处理持久化接口`生成带水印的视频，并且使用`saveas`命令覆盖原视频文件后，无法再用`vthumb`命令一次性同时创建水印图片，必须请求两次。。

遇到的问题则是由于我忽视了视频转码需要时间的问题，上传成功后在文件管理里没有看到带水印的视频，就以为参数错误，直接把文件删了...

直到我用了[七牛云存储实验室](https://github.com/qiniu/qiniulab)，在查询结果时看到了正在转码的信息，才意识到确实需要创建一个私有的多媒体处理队列。

虽说浪费了时间，但是熟悉了七牛云转码和水印相关接口，而且是SpringBoot环境下的应用，算是一段有价值的经历吧。


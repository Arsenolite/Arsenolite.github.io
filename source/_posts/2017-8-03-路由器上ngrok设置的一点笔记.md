---
title: 路由器上ngrok设置的一点笔记
tags:
  - 路由器
  - k3
  - 内网穿透
categories:
  - 2017-08
abbrlink: e19a37a2
date: 2017-08-03 09:19:48
---

鸟枪换炮，用k3把残疾的k2给换了。

k3除了千兆LAN口外，最大的好处就是补上了U口，而且还是3.0的。既然能挂载硬盘，那这不就成了一个小型的NAS吗？

目前我是在出租屋里蹭着房东的网，本来想通过阿里云DDNS，完成在外网访问路由器（aria2随时上车）的目的。

作为二级路由，要实现DDNS，必须要一级路由开启端口转发，但是房东的路由器管理权并不在我手中。

一开始想爆破，找不到太好的爆破机器，自己又懒得写，试了几个弱口令失败后放弃了。看样子房东家里应该有略懂一点的人在吧。

于是只好另辟蹊径，采用ngrok客户端完成内网映射。

我使用的是https://ngrok.cc/  这家免费的ngrok服务提供者，注册账户之后会提供一个Token，直接开通免费的HTTP隧道。

先随便填写一个前置域名，用户名和密码也随便填写，本地端口写了127.1:80，用于访问路由器的Web管理页面。

保存，点击进入修改，将域名改为自定义域名，我直接在我买的域名上开了个二级域名，并且按照网站的提示，把CNAME解析到了server.ngrok.cc。

连上k3，在客户端里把令牌填好，下面的通道和网站上设置保持一致，保存。

----

这里遇到另一个问题，aria2是分为本体+web控制台的，而web控制台连接的是本体提供的RPC接口，端口是6800。

而目前的隧道只有80端口转发，因此会出现连不上的情况。

这里有一个坑，表面看起来aria2用的是`http://xxx:6800/jsonrpc`的地址，但是网站和路由器中一定要开TCP隧道，本地端口写6800，服务器端口随便选一个没被占用的。

接下来修改aria2Web控制台配置，把RPC地址改成隧道的地址即可。同时为了安全，将aria2的rpc连接修改为需要Token，保持Web控制台和路由器中的设置一致即可。
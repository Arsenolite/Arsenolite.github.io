---
title: Banner图模块错题本
date: 2019-08-28 11:18:06
categories: ["2019-08"]
tags: ["错题本"]
---
……尝试治一下自己的毛病

大致就是，写代码的时候做出许多假设，测试的时候发现假设并不总是成立。。

很多都是非常细小的问题，交付一个模块的时候记一下，不要再犯就是了

2019-9-16
从前往后

标签模块
+ 表名先用了复数，手写sql没改过来
+ 没考虑添加商品时没有带标签的情况
+ 删除接口Controller的请求方法写错
+ TagDTO用于传输公司id，使用BeanUtils.copy时将公司id复制过去，导致返回结果多出公司id来
+ 根据标签名搜索商品时 标签名与商品名条件应用OR排列，标签id应用and排列

2019-9-11 打脸

+ 商品列表我认为是空列表，但是没有再swagger里写清楚，前端不知是传空数组还是不传
包括活动页Banner的必传性我也没有写清楚
而我后台做了许多没有判null就进行的操作

+ 是否需要主标题为空的校验写错了类型，写到了个人中心页的Banner

+ 手动把模块表的某条记录从逻辑删除恢复，然后忘了恢复图片。。导致这个类型的模块拿不到，手动修了数据

+ 哎呦，吐了，设计出现重大问题
之前做小程序banner一对多是按图片id做group，因为不想改原有数据结构
现在出现问题了，用两张相同的图片发现商品id被group到一个图片里去了

得改改，用json字符串存这个图片-商品一对多好了



---

+ 关联查询时，由于习惯Mybatis Plus的自动过滤逻辑删除特性，自己撰写SQL时没有过滤关联查询表的已经逻辑删除的记录、以及子表中不存在的记录
代码：

```java
@Select("select m.id as module_id,m.is_required,m.title,m.subtitle,m.type,i.file_id,i.product_id,i.pno " +
            "from wsc_pc_banner_module m left join wsc_pc_banner_image i on i.module_id = m.id " +
            "${ew.customSqlSegment} and (i.is_deleted is NULL or i.is_deleted = 0) and m.is_deleted = 0 order by m.id")
    List<WscPcBannerDO> selectBanner(@Param(Constants.WRAPPER) Wrapper wrapper);
```
重点在于`and (i.is_deleted is NULL or i.is_deleted = 0)`

+ 根据类型筛选Banner图，前端应该这么传值：

```http
GET {{adminHost}}/microManage/pcBanner?type=0&type=3&type=4&type=5
Content-Type: application/json
Authorization: {{adminToken}}
```
后端应该这么接受：
```java
@GetMapping("/pcBanner")
public JsonResult pcBanner(@RequestParam(required = false) Integer[] type) {
    //...
}
```
前端直接用[0,3,4,5]这样的后端是接收不到的。。后端也不能用List<Integer>来接受。。感觉这个设计有一点丑，但又不想额外写代码转换。。

